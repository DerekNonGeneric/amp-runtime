(self.AMP=self.AMP||[]).push({n:"amp-app-banner",v:"123456789",f:(function(AMP){function g(a,b){function d(){}d.prototype=b.prototype;a.prototype=new d;a.prototype.constructor=a;for(var c in b)if(Object.defineProperties){var e=Object.getOwnPropertyDescriptor(b,c);e&&Object.defineProperty(a,c,e)}else a[c]=b[c]};Date.now();function h(a){for(var b=null,d="",c=0;c<arguments.length;c++){var e=arguments[c];if(e instanceof Error&&!b){var b=e,e=b.message,f=String(Math.random());b.message=f;if(b.message===f)b.message=e;else{e=Error(b.message);f=void 0;for(f in b)e[f]=b[f];e.stack=b.stack;b=e}}else d&&(d+=" "),d+=e}b?d&&(b.message=d+": "+b.message):b=Error(d);return b}function k(a){var b=h.apply(null,arguments);setTimeout(function(){self.reportError(b);throw b;})}self.log=self.log||{user:null,dev:null};var l=self.log;
function m(){if(l.user)return l.user;throw Error("failed to call initLogConstructor");}function n(){if(l.dev)return l.dev;throw Error("failed to call initLogConstructor");};function q(a){var b=Object.create(null);a&&Object.assign(b,a);return b};var r=self.AMP_CONFIG||{},t=("string"==typeof r.cdnProxyRegex?new RegExp(r.cdnProxyRegex):r.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org/;var u,v,w=["javascript:","data:","vbscript:"];
function x(a){var b;u||(u=self.document.createElement("a"),v=self.UrlCache||(self.UrlCache=Object.create(null)));var d=v[a];if(d)return d;var c=u;c.href=a;c.protocol||(c.href=c.href);var e={href:c.href,protocol:c.protocol,host:c.host,hostname:c.hostname,port:"0"==c.port?"":c.port,pathname:c.pathname,search:c.search,hash:c.hash,origin:null};"/"!==e.pathname[0]&&(e.pathname="/"+e.pathname);if("http:"==e.protocol&&80==e.port||"https:"==e.protocol&&443==e.port)e.port="",e.host=e.hostname;e.origin=c.origin&&
"null"!=c.origin?c.origin:"data:"!=e.protocol&&e.host?e.protocol+"//"+e.host:e.href;var f=e,p=f;return b?p:v[a]=p}function y(a){"string"==typeof a&&(a=x(a));var b;(b="https:"==a.protocol||"localhost"==a.hostname)||(a=a.hostname,b=a.length-10,b=0<=b&&a.indexOf(".localhost",b)==b);return b}function z(a){if(!a)return!0;"string"==typeof a&&(a=x(a));return!w.includes(a.protocol)};function A(a,b){a=a.__AMP_TOP||a;return B(a,b)}function C(a,b){a=D(a);a=E(a);return B(a,b)}function D(a){return a.nodeType?A((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function E(a){a=D(a);return a.isSingleDoc()?a.win:a}function B(a,b){var d=F(a);a=d[b];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}
function G(a){var b=H(a);if(b)return b;var d,c=new Promise(function(a){d=a});F(a).storage={obj:null,promise:c,resolve:d,context:null,ctor:null};return c}function H(a){var b=F(a).storage;if(b){if(b.promise)return b.promise;B(a,"storage");return b.promise=Promise.resolve(b.obj)}return null}function F(a){var b=a.services;b||(b=a.services={});return b};function I(a,b){var d,c;try{c=a.open(b,"_top",d)}catch(e){n().error("DOM","Failed to open url on target: ","_top",e)}};function J(a){AMP.BaseElement.call(this,a);this.f=null;this.b=!1}g(J,AMP.BaseElement);J.prototype.isLayoutSupported=function(a){return"nodisplay"==a};J.prototype.openButtonClicked=function(){};function K(a,b,d,c){b.addEventListener("click",function(){a.openButtonClicked(d,c)})}J.prototype.j=function(){this.getVsync().run({measure:void 0,mutate:L},{element:this.element,viewport:this.getViewport(),storagePromise:G(E(this.getAmpDoc())),storageKey:M(this)})};
function M(a){var b=m().assert(a.element.id,"amp-app-banner should have an id.");return"amp-app-banner:"+b}J.prototype.isDismissed=function(){var a=this;return G(E(this.getAmpDoc())).then(function(b){return b.get(M(a))}).then(function(a){return!!a},function(a){n().error("amp-app-banner","Failed to read storage",a);return!1})};
function N(a){a.isDismissed().then(function(b){if(b)O(a);else{var d=a.win.document.createElement("i-amphtml-app-banner-top-padding");a.element.appendChild(d);d=a.win.document.createElement("button");d.classList.add("amp-app-banner-dismiss-button");d.setAttribute("aria-label",a.element.getAttribute("data-dismiss-button-aria-label")||"Dismiss");var c=a.j.bind(a);d.addEventListener("click",c);a.element.appendChild(d);a.getVsync().run({measure:P,mutate:Q},{element:a.element,viewport:a.getViewport()});
a.expand()}})}function O(a){return a.getVsync().runPromise({measure:void 0,mutate:R},{element:a.element,viewport:a.getViewport()})}function S(a){J.call(this,a)}g(S,J);S.prototype.upgradeCallback=function(){var a=A(this.win,"platform");return a.isIos()?new T(this.element):a.isAndroid()?new U(this.element):null};S.prototype.layoutCallback=function(){m().info("amp-app-banner","Only iOS or Android platforms are currently supported.");return O(this)};
function T(a){J.call(this,a);this.a=C(this.getAmpDoc(),"viewer");this.h=null}g(T,J);T.prototype.preconnectCallback=function(a){this.element.parentNode&&this.preconnect.url("https://itunes.apple.com",a)};
T.prototype.buildCallback=function(){var a=A(this.win,"platform");(this.b=!this.a.isEmbedded()&&a.isSafari())?(m().info("amp-app-banner","Browser supports builtin banners. Not rendering amp-app-banner."),O(this)):this.a.isEmbedded()&&!this.a.hasCapability("navigateTo")?O(this):(this.h=this.win.document.head.querySelector("meta[name=apple-itunes-app]"))?(this.f=m().assert(this.element.querySelector("button[open-button]"),"<button open-button> is required inside %s: %s","amp-app-banner",this.element),
V(this,this.h.getAttribute("content")),N(this)):O(this)};T.prototype.layoutCallback=function(){return Promise.resolve()};T.prototype.openButtonClicked=function(a,b){var d=this;this.a.isEmbedded()?(A(this.win,"timer").delay(function(){d.a.sendMessage("navigateTo",q({url:b}))},1500),this.a.sendMessage("navigateTo",q({url:a}))):(A(this.win,"timer").delay(function(){I(d.win,b)},1500),I(this.win,a))};
function V(a,b){var d=b.replace(/\s/,"").split(","),c={};d.forEach(function(a){var b=a.split("=");c[b[0]]=b[1]});var e=c["app-id"],f=c["app-argument"];f&&m().assert(z(f),"The url in app-argument has invalid protocol: %s",f);var p="https://itunes.apple.com/us/app/id"+e;K(a,a.f,f||p,p)}function U(a){J.call(this,a);this.g=null;this.c="";this.i=!1}g(U,J);U.prototype.preconnectCallback=function(a){this.element.parentNode&&(this.preconnect.url("https://play.google.com",a),this.c&&this.preconnect.preload(this.c))};
U.prototype.buildCallback=function(){var a=C(this.getAmpDoc(),"viewer");this.g=this.win.document.head.querySelector("link[rel=manifest],link[rel=origin-manifest]");var b=A(this.win,"platform"),d=b.isAndroid()&&b.isChrome(),c=this.win.location;"string"==typeof c&&(c=x(c));if(this.b=!t.test(c.origin)&&!a.isEmbedded()&&d)m().info("amp-app-banner","Browser supports builtin banners. Not rendering amp-app-banner."),O(this);else if(this.i=b.isAndroid()&&!this.g)O(this);else{var b=this.c=this.g.getAttribute("href"),
c=this.element,e="manifest href",e=void 0===e?"source":e;m().assert(null!=b,"%s %s must be available",c,e);m().assert(y(b)||/^(\/\/)/.test(b),'%s %s must start with "https://" or "//" or be relative and served from either https or from localhost. Invalid value: %s',c,e,b);this.f=m().assert(this.element.querySelector("button[open-button]"),"<button open-button> is required inside %s: %s","amp-app-banner",this.element);N(this)}};
U.prototype.layoutCallback=function(){var a=this;return this.i||this.b?Promise.resolve():A(this.win,"xhr").fetchJson(this.c,{requireAmpResponseSourceOrigin:!1}).then(function(a){return a.json()}).then(function(b){var d;a:{if(d=b.related_applications){for(var c=0;c<d.length;c++){var e=d[c];if("play"==e.platform){d="https://play.google.com/store/apps/details?id="+e.id;var e=e.id,c=C(a.element,"documentInfo").get().canonicalUrl,c=x(c),f=c.protocol.replace(":","");K(a,a.f,"android-app://"+e+"/"+f+"/"+
c.host+c.pathname,d);d=void 0;break a}}m().warn("amp-app-banner","Could not find a platform=play app in manifest: %s",a.element)}else m().warn("amp-app-banner","related_applications is missing from manifest.json file: %s",a.element);d=void 0}return d}).catch(function(b){O(a);k(b)})};U.prototype.openButtonClicked=function(a,b){var d=this;A(this.win,"timer").delay(function(){d.win.top.location.assign(b)},1500);I(this.win,a)};
function L(a){R(a);a.storagePromise.then(function(b){b.set(a.storageKey,!0)})}function R(a){a.viewport.removeFromFixedLayer(a.element);var b=a.element;b.parentElement&&b.parentElement.removeChild(b);a.viewport.updatePaddingBottom(0)}function P(a){a.bannerHeight=a.viewport.getLayoutRect(a.element).height}function Q(a){a.viewport.updatePaddingBottom(a.bannerHeight);a.viewport.addToFixedLayer(a.element)}AMP.registerElement("amp-app-banner",S,"amp-app-banner{position:fixed!important;bottom:0!important;left:0;width:100%;max-height:100px!important;box-sizing:border-box;background:#fff;z-index:13;box-shadow:0 0 5px 0 rgba(0,0,0,.2)!important}i-amphtml-app-banner-top-padding{position:absolute;top:0;left:0;right:0;background:#fff;height:4px;z-index:15}.amp-app-banner-dismiss-button{position:absolute;width:28px;height:28px;top:-28px;right:0;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='13' height='13' viewBox='341 8 13 13' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath fill='%234F4F4F' d='M354 9.31L352.69 8l-5.19 5.19L342.31 8 341 9.31l5.19 5.19-5.19 5.19 1.31 1.31 5.19-5.19 5.19 5.19 1.31-1.31-5.19-5.19z' fill-rule='evenodd'/%3E%3C/svg%3E\");background-size:13px 13px;background-position:9px center;background-color:#fff;background-repeat:no-repeat;z-index:14;box-shadow:0 0 5px 0 rgba(0,0,0,.2);border:none;border-top-left-radius:12px}.amp-app-banner-dismiss-button:before{position:absolute;content:'';top:-20px;right:0;left:-20px;bottom:0}[dir=rtl] .amp-app-banner-dismiss-button{right:auto;left:0;border-top-left-radius:0;border-top-right-radius:12px;background-position:6px center}[dir=rtl] .amp-app-banner-dismiss-button:before{right:-20px;left:0}\n/*# sourceURL=/extensions/amp-app-banner/0.1/amp-app-banner.css*/");
})});
//# sourceMappingURL=amp-app-banner-0.1.js.map

