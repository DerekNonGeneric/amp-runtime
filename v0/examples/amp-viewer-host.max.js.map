{"version":3,"sources":["node_modules/browser-pack/_prelude.js","extensions/amp-viewer-integration/0.1/examples/amp-viewer-host.js","extensions/amp-viewer-integration/0.1/messaging/messaging.js","src/event-helper-listen.js","src/event-helper.js","src/json.js","src/log.js","src/mode-object.js","src/mode.js","src/string.js","src/types.js","src/url-parse-query-string.js","third_party/babel/custom-babel-helpers.js"],"names":[],"mappings":"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","file":"amp-viewer-host.max.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/**\n * Copyright 2017 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport '../../../../third_party/babel/custom-babel-helpers';\nimport {\n  APP,\n  Messaging,\n  MessageType,\n  WindowPortEmulator,\n} from '../messaging/messaging';\nimport {listen} from '../../../../src/event-helper';\n\nconst CHANNEL_OPEN_MSG = 'channelOpen';\n\n/**\n * @fileoverview This is an example of how the viewer host can be implemented\n * for communication with the AMP docs.\n */\nexport class AmpViewerHost {\n\n  /**\n   * @param {!Window} win\n   * @param {!HTMLIFrameElement} ampIframe\n   * @param {string} frameOrigin\n   * @param {function(string, *, boolean):(!Promise<*>|undefined)} messageHandler\n   * @param {string=} opt_logsId For dev logs so you know what ampdoc you're\n   * @param {boolean=} opt_isWebview Should viewer initiate handshake w/ polling\n   * @param {boolean=} opt_isHandshakePoll\n   * looking at.\n   */\n  constructor(win, ampIframe, frameOrigin, messageHandler, opt_logsId,\n      opt_isWebview, opt_isHandshakePoll) {\n    /** @const {!Window} */\n    this.win = win;\n    /** @private {!HTMLIFrameElement} */\n    this.ampIframe_ = ampIframe;\n    /** @private {function(string, *, boolean):(!Promise<*>|undefined)} */\n    this.messageHandler_ = messageHandler;\n    /** @const {boolean} */\n    this.isWebview_ = !!opt_isWebview;\n    /** @const {string} */\n    this.logsId = opt_logsId;\n\n    if (this.isWebview_ || opt_isHandshakePoll) {\n      /** @private {number} */\n      this.pollingIntervalId_ = setInterval(\n          this.initiateHandshake_.bind(this, this.intervalCtr) , 1000); //poll every second\n    } else {\n      this.waitForHandshake_(frameOrigin);\n    }\n  }\n\n  /**\n   * @private\n   */\n  initiateHandshake_() {\n    this.log('initiateHandshake_');\n    if (this.ampIframe_) {\n      const channel = new MessageChannel();\n      let message = {\n        app: APP,\n        name: 'handshake-poll',\n      };\n      message = this.isWebview_ ? JSON.stringify(message) : message;\n      this.ampIframe_.contentWindow./*OK*/postMessage(\n          message, '*', [channel.port2]);\n\n      channel.port1.onmessage = function(e) {\n        const data = this.isWebview_ ? JSON.parse(e.data) : e.data;\n        if (this.isChannelOpen_(data)) {\n          this.win.clearInterval(this.pollingIntervalId_); //stop polling\n          this.log('messaging established!');\n          this.completeHandshake_(channel.port1, data.requestid);\n        } else {\n          this.messageHandler_(data.name, data.data, data.rsvp);\n        }\n      }.bind(this);\n    }\n  }\n\n  /**\n   * @param {string} targetOrigin\n   * @private\n   */\n  waitForHandshake_(targetOrigin) {\n    this.log('awaitHandshake_');\n    let unlisten = null;\n    const target = this.ampIframe_.contentWindow;\n    const listener = function(event) {\n      if (event.origin == targetOrigin &&\n              this.isChannelOpen_(event.data) &&\n              (!event.source || event.source == target)) {\n        this.log(' messaging established with ', targetOrigin);\n        unlisten();\n        const port = new WindowPortEmulator(this.win, targetOrigin, target);\n        this.completeHandshake_(port, event.data.requestid);\n      }\n    }.bind(this);\n    unlisten = listen(this.win, 'message', listener);\n  }\n\n  /**\n   * @param {!MessagePort|!WindowPortEmulator} port\n   * @param {string} requestId\n   * @private\n   */\n  completeHandshake_(port, requestId) {\n    let message = {\n      app: APP,\n      requestid: requestId,\n      type: MessageType.RESPONSE,\n    };\n\n    message = this.isWebview_ ? JSON.stringify(message) : message;\n    this.log('posting Message', message);\n    port./*OK*/postMessage(message);\n\n    this.messaging_ = new Messaging(this.win, port);\n    this.messaging_.setDefaultHandler(this.messageHandler_);\n\n    this.sendRequest('visibilitychange', {\n      state: this.visibilityState_,\n      prerenderSize: this.prerenderSize,\n    }, true);\n  };\n\n  /**\n   * @param {*} eventData\n   * @return {boolean}\n   * @private\n   */\n  isChannelOpen_(eventData) {\n    return eventData.app == APP && eventData.name == CHANNEL_OPEN_MSG;\n  };\n\n  /**\n   * @param {string} type\n   * @param {*} data\n   * @param {boolean} awaitResponse\n   * @return {!Promise<*>|undefined}\n   */\n  sendRequest(type, data, awaitResponse) {\n    this.log('sendRequest');\n    if (!this.messaging_) {\n      return;\n    }\n    return this.messaging_.sendRequest(type, data, awaitResponse);\n  };\n\n  log() {\n    const var_args = Array.prototype.slice.call(arguments, 0);\n    var_args.unshift('[ViewerHost ' + this.logsId + ']');\n    console/*OK*/.log.apply(console, var_args);\n  }\n}\n\nself.AmpViewerHost = AmpViewerHost;\n","/**\n * Copyright 2017 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {parseJson} from '../../../../src/json';\n\nconst TAG = 'amp-viewer-messaging';\nexport const APP = '__AMPHTML__';\n\n/**\n * @enum {string}\n */\nexport const MessageType = {\n  REQUEST: 'q',\n  RESPONSE: 's',\n};\n\n/**\n * @typedef {!AmpViewerMessage}\n */\nexport let Message;\n\n/**\n * @typedef {function(string, *, boolean):(!Promise<*>|undefined)}\n */\nexport let RequestHandler;\n\n/**\n  * @param {*} message\n  * @return {?Message}\n  */\nexport function parseMessage(message) {\n  if (typeof message != 'string') {\n    return /** @type {Message} */(message);\n  }\n  if (message.charAt(0) != '{') {\n    return null;\n  }\n\n  try {\n    return /** @type {?Message} */ (\n        /** @type {?} */ (parseJson(/** @type {string} */ (message))));\n  } catch (e) {\n    return null;\n  }\n}\n\n\n/**\n * @fileoverview This class is a de-facto implementation of MessagePort\n * from Channel Messaging API:\n * https://developer.mozilla.org/en-US/docs/Web/API/Channel_Messaging_API\n */\nexport class WindowPortEmulator {\n  /**\n   * @param {!Window} win\n   * @param {string} origin\n   * @param {!Window} target\n   */\n  constructor(win, origin, target) {\n    /** @const {!Window} */\n    this.win = win;\n    /** @private {string} */\n    this.origin_ = origin;\n    /** @const {!Window} */\n    this.target_ = target;\n  }\n\n  /**\n   * @param {string} eventType\n   * @param {function(!Event):undefined} handler\n   */\n  addEventListener(eventType, handler) {\n    this.win.addEventListener('message', e => {\n      if (e.origin == this.origin_ &&\n          e.source == this.target_ && e.data.app == APP) {\n        handler(e);\n      }\n    });\n  }\n\n  /**\n   * @param {JsonObject} data\n   */\n  postMessage(data) {\n    this.target_./*OK*/postMessage(data, this.origin_);\n  }\n  start() {\n  }\n}\n\n/**\n * @fileoverview This is used in amp-viewer-integration.js for the\n * communication protocol between AMP and the viewer. In the comments, I will\n * refer to the communication as a conversation between me and Bob. The\n * messaging protocol should support both sides, but at this point I'm the\n * ampdoc and Bob is the viewer.\n */\nexport class Messaging {\n\n  /**\n   * Conversation (messaging protocol) between me and Bob.\n   * @param {!Window} win\n   * @param {!MessagePort|!WindowPortEmulator} port\n   * @param {boolean} opt_isWebview\n   */\n  constructor(win, port, opt_isWebview) {\n    /** @const {!Window} */\n    this.win = win;\n    /** @const @private {!MessagePort|!WindowPortEmulator} */\n    this.port_ = port;\n    /** @const @private */\n    this.isWebview_ = !!opt_isWebview;\n    /** @private {!number} */\n    this.requestIdCounter_ = 0;\n    /** @private {!Object<number, {resolve: function(*), reject: function(!Error)}>} */\n    this.waitingForResponse_ = {};\n    /**\n     * A map from message names to request handlers.\n     * @private {!Object<string, !RequestHandler>}\n     */\n    this.messageHandlers_ = {};\n\n    /** @private {?RequestHandler} */\n    this.defaultHandler_ = null;\n\n    this.port_.addEventListener('message', this.handleMessage_.bind(this));\n    this.port_.start();\n  }\n\n  /**\n   * Registers a method that will handle requests sent to the specified\n   * message name.\n   * @param {string} messageName The name of the message to handle.\n   * @param {!RequestHandler} requestHandler\n   */\n  registerHandler(messageName, requestHandler) {\n    this.messageHandlers_[messageName] = requestHandler;\n  }\n\n  /**\n   * Unregisters the handler for the specified message name.\n   * @param {string} messageName The name of the message to unregister.\n   */\n  unregisterHandler(messageName) {\n    delete this.messageHandlers_[messageName];\n  }\n\n  /**\n   * @param {?RequestHandler} requestHandler\n   */\n  setDefaultHandler(requestHandler) {\n    this.defaultHandler_ = requestHandler;\n  }\n\n  /**\n   * Bob sent me a message. I need to decide if it's a new request or\n   * a response to a previous 'conversation' we were having.\n   * @param {!Event} event\n   * @private\n   */\n  handleMessage_(event) {\n    const message = parseMessage(event.data);\n    if (!message) {\n      return;\n    }\n    if (message.type == MessageType.REQUEST) {\n      this.handleRequest_(message);\n    } else if (message.type == MessageType.RESPONSE) {\n      this.handleResponse_(message);\n    }\n  }\n\n  /**\n   * I'm sending Bob a new outgoing request.\n   * @param {string} messageName\n   * @param {?JsonObject|string|undefined} messageData\n   * @param {boolean} awaitResponse\n   * @return {!Promise<*>|undefined}\n   */\n  sendRequest(messageName, messageData, awaitResponse) {\n    const requestId = ++this.requestIdCounter_;\n    let promise = undefined;\n    if (awaitResponse) {\n      promise = new Promise((resolve, reject) => {\n        this.waitingForResponse_[requestId] = {resolve, reject};\n      });\n    }\n    this.sendMessage_(/** @type {!AmpViewerMessage} */ ({\n      app: APP,\n      requestid: requestId,\n      type: MessageType.REQUEST,\n      name: messageName,\n      data: messageData,\n      rsvp: awaitResponse,\n    }));\n    return promise;\n  }\n\n  /**\n   * I'm responding to a request that Bob made earlier.\n   * @param {number} requestId\n   * @param {string} messageName\n   * @param {*} messageData\n   * @private\n   */\n  sendResponse_(requestId, messageName, messageData) {\n    this.sendMessage_(/** @type {!AmpViewerMessage} */ ({\n      app: APP,\n      requestid: requestId,\n      type: MessageType.RESPONSE,\n      name: messageName,\n      data: messageData,\n    }));\n  }\n\n  /**\n   * @param {number} requestId\n   * @param {string} messageName\n   * @param {*} reason !Error most of time, string sometimes, * rarely.\n   * @private\n   */\n  sendResponseError_(requestId, messageName, reason) {\n    const errString = this.errorToString_(reason);\n    this.logError_(\n        TAG + ': sendResponseError_, Message name: ' + messageName, errString);\n    this.sendMessage_(/** @type {!AmpViewerMessage} */ ({\n      app: APP,\n      requestid: requestId,\n      type: MessageType.RESPONSE,\n      name: messageName,\n      data: null,\n      error: errString,\n    }));\n  }\n\n  /**\n   * @param {Message} message\n   * @private\n   */\n  sendMessage_(message) {\n    this.port_./*OK*/postMessage(\n        this.isWebview_\n            ? JSON.stringify(message)\n            : message);\n  }\n\n  /**\n   * I'm handing an incoming request from Bob. I'll either respond normally\n   * (ex: \"got it Bob!\") or with an error (ex: \"I didn't get a word of what\n   * you said!\").\n   * @param {Message} message\n   * @private\n   */\n  handleRequest_(message) {\n    let handler = this.messageHandlers_[message.name];\n    if (!handler) {\n      handler = this.defaultHandler_;\n    }\n    if (!handler) {\n      const error = new Error(\n        'Cannot handle request because handshake is not yet confirmed!');\n      error.args = message.name;\n      throw error;\n    }\n\n    const promise = handler(message.name, message.data, !!message.rsvp);\n    if (message.rsvp) {\n      const requestId = message.requestid;\n      if (!promise) {\n        this.sendResponseError_(\n            requestId, message.name, new Error('no response'));\n        throw new Error('expected response but none given: ' + message.name);\n      }\n      promise.then(data => {\n        this.sendResponse_(requestId, message.name, data);\n      }, reason => {\n        this.sendResponseError_(requestId, message.name, reason);\n      });\n    }\n  }\n\n  /**\n   * I sent out a request to Bob. He responded. And now I'm handling that\n   * response.\n   * @param {Message} message\n   * @private\n   */\n  handleResponse_(message) {\n    const requestId = message.requestid;\n    const pending = this.waitingForResponse_[requestId];\n    if (pending) {\n      delete this.waitingForResponse_[requestId];\n      if (message.error) {\n        this.logError_(TAG + ': handleResponse_ error: ', message.error);\n        pending.reject(\n            new Error(`Request ${message.name} failed: ${message.error}`));\n      } else {\n        pending.resolve(message.data);\n      }\n    }\n  }\n\n  /**\n   * @param {string} state\n   * @param {!Error|string} opt_data\n   * @private\n   */\n  logError_(state, opt_data) {\n    let stateStr = 'amp-messaging-error-logger: ' + state;\n    const dataStr = ' data: ' + this.errorToString_(opt_data);\n    stateStr += dataStr;\n    this.win['viewerState'] = stateStr;\n  };\n\n  /**\n   * @param {*} err !Error most of time, string sometimes, * rarely.\n   * @return {string}\n   * @private\n   */\n  errorToString_(err) {\n    return err ?\n      (err.message ? err.message : String(err)) :\n      'unknown error';\n  }\n}\n","/**\n * Copyright 2017 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Listens for the specified event on the element.\n *\n * Do not use this directly. This method is implemented as a shared\n * dependency. Use `listen()` in either `event-helper` or `3p-frame-messaging`,\n * depending on your use case.\n *\n * @param {!EventTarget} element\n * @param {string} eventType\n * @param {function(!Event)} listener\n * @param {boolean=} opt_capture\n * @return {!UnlistenDef}\n */\nexport function internalListenImplementation(element, eventType, listener,\n    opt_capture) {\n  let localElement = element;\n  let localListener = listener;\n  /** @type {?Function}  */\n  let wrapped = event => {\n    try {\n      return localListener(event);\n    } catch (e) {\n      // reportError is installed globally per window in the entry point.\n      self.reportError(e);\n      throw e;\n    }\n  };\n  const capture = opt_capture || false;\n  localElement.addEventListener(eventType, wrapped, capture);\n  return () => {\n    if (localElement) {\n      localElement.removeEventListener(eventType, wrapped, capture);\n    }\n    // Ensure these are GC'd\n    localListener = null;\n    localElement = null;\n    wrapped = null;\n  };\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {internalListenImplementation} from './event-helper-listen';\nimport {user} from './log';\n\n/** @const {string}  */\nconst LOAD_FAILURE_PREFIX = 'Failed to load:';\n\n/**\n * Returns a CustomEvent with a given type and detail; supports fallback for IE.\n * @param {!Window} win\n * @param {string} type\n * @param {Object} detail\n * @param {EventInit=} opt_eventInit\n * @return {!Event}\n */\nexport function createCustomEvent(win, type, detail, opt_eventInit) {\n  const eventInit = /** @type {CustomEventInit} */ ({detail});\n  Object.assign(eventInit, opt_eventInit);\n  // win.CustomEvent is a function on Edge, Chrome, FF, Safari but\n  // is an object on IE 11.\n  if (typeof win.CustomEvent == 'function') {\n    return new win.CustomEvent(type, eventInit);\n  } else {\n    // Deprecated fallback for IE.\n    const e = win.document.createEvent('CustomEvent');\n    e.initCustomEvent(\n        type, !!eventInit.bubbles, !!eventInit.cancelable, detail);\n    return e;\n  }\n}\n\n/**\n * Listens for the specified event on the element.\n * @param {!EventTarget} element\n * @param {string} eventType\n * @param {function(!Event)} listener\n * @param {boolean=} opt_capture\n * @return {!UnlistenDef}\n */\nexport function listen(element, eventType, listener, opt_capture) {\n  return internalListenImplementation(\n      element, eventType, listener, opt_capture);\n}\n\n\n/**\n * Listens for the specified event on the element and removes the listener\n * as soon as event has been received.\n * @param {!EventTarget} element\n * @param {string} eventType\n * @param {function(!Event)} listener\n * @param {boolean=} opt_capture\n * @return {!UnlistenDef}\n */\nexport function listenOnce(element, eventType, listener, opt_capture) {\n  let localListener = listener;\n  const unlisten = internalListenImplementation(element, eventType, event => {\n    try {\n      localListener(event);\n    } finally {\n      // Ensure listener is GC'd\n      localListener = null;\n      unlisten();\n    }\n  }, opt_capture);\n  return unlisten;\n}\n\n\n/**\n * Returns  a promise that will resolve as soon as the specified event has\n * fired on the element.\n * @param {!EventTarget} element\n * @param {string} eventType\n * @param {boolean=} opt_capture\n * @param {function(!UnlistenDef)=} opt_cancel An optional function that, when\n *     provided, will be called with the unlistener. This gives the caller\n *     access to the unlistener, so it may be called manually when necessary.\n * @return {!Promise<!Event>}\n */\nexport function listenOncePromise(element, eventType, opt_capture, opt_cancel) {\n  let unlisten;\n  const eventPromise = new Promise(resolve => {\n    unlisten = listenOnce(element, eventType, resolve, opt_capture);\n  });\n  eventPromise.then(unlisten, unlisten);\n  if (opt_cancel) {\n    opt_cancel(unlisten);\n  }\n  return eventPromise;\n}\n\n\n/**\n * Whether the specified element/window has been loaded already.\n * @param {!Element|!Window} eleOrWindow\n * @return {boolean}\n */\nexport function isLoaded(eleOrWindow) {\n  return !!(eleOrWindow.complete || eleOrWindow.readyState == 'complete'\n      // If the passed in thing is a Window, infer loaded state from\n      //\n      || (eleOrWindow.document\n          && eleOrWindow.document.readyState == 'complete'));\n}\n\n/**\n * Returns a promise that will resolve or fail based on the eleOrWindow's 'load'\n * and 'error' events. Optionally this method takes a timeout, which will reject\n * the promise if the resource has not loaded by then.\n * @param {T} eleOrWindow Supports both Elements and as a special case Windows.\n * @return {!Promise<T>}\n * @template T\n */\nexport function loadPromise(eleOrWindow) {\n  let unlistenLoad;\n  let unlistenError;\n  if (isLoaded(eleOrWindow)) {\n    return Promise.resolve(eleOrWindow);\n  }\n  const loadingPromise = new Promise((resolve, reject) => {\n    // Listen once since IE 5/6/7 fire the onload event continuously for\n    // animated GIFs.\n    const tagName = eleOrWindow.tagName;\n    if (tagName === 'AUDIO' || tagName === 'VIDEO') {\n      unlistenLoad = listenOnce(eleOrWindow, 'loadstart', resolve);\n    } else {\n      unlistenLoad = listenOnce(eleOrWindow, 'load', resolve);\n    }\n    // For elements, unlisten on error (don't for Windows).\n    if (tagName) {\n      unlistenError = listenOnce(eleOrWindow, 'error', reject);\n    }\n  });\n\n  return loadingPromise.then(() => {\n    if (unlistenError) {\n      unlistenError();\n    }\n    return eleOrWindow;\n  }, () => {\n    if (unlistenLoad) {\n      unlistenLoad();\n    }\n    failedToLoad(eleOrWindow);\n  });\n}\n\n/**\n * Emit error on load failure.\n * @param {!Element|!Window} eleOrWindow Supports both Elements and as a special\n *     case Windows.\n */\nfunction failedToLoad(eleOrWindow) {\n  // Report failed loads as user errors so that they automatically go\n  // into the \"document error\" bucket.\n  let target = eleOrWindow;\n  if (target && target.src) {\n    target = target.src;\n  }\n  throw user().createError(LOAD_FAILURE_PREFIX, target);\n}\n\n/**\n * Returns true if this error message is was created for a load error.\n * @param {string} message An error message\n * @return {boolean}\n */\nexport function isLoadErrorMessage(message) {\n  return message.indexOf(LOAD_FAILURE_PREFIX) != -1;\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @fileoverview This module declares JSON types as defined in the\n * {@link http://json.org/}.\n */\n\nimport {isObject} from './types';\n\n\n// NOTE Type are changed to {*} because of\n// https://github.com/google/closure-compiler/issues/1999\n\n/**\n * JSON scalar. It's either string, number or boolean.\n * @typedef {*} should be string|number|boolean\n */\nlet JSONScalarDef;\n\n\n/**\n * JSON object. It's a map with string keys and JSON values.\n * @typedef {*} should be !Object<string, ?JSONValueDef>\n */\nlet JSONObjectDef;\n\n\n/**\n * JSON array. It's an array with JSON values.\n * @typedef {*} should be !Array<?JSONValueDef>\n */\nlet JSONArrayDef;\n\n\n/**\n * JSON value. It's either a scalar, an object or an array.\n * @typedef {*} should be !JSONScalarDef|!JSONObjectDef|!JSONArrayDef\n */\nlet JSONValueDef;\n\n\n/**\n * Recreates objects with prototype-less copies.\n * @param {!JsonObject} obj\n * @return {!JsonObject}\n */\nexport function recreateNonProtoObject(obj) {\n  const copy = Object.create(null);\n  for (const k in obj) {\n    if (!hasOwnProperty(obj, k)) {\n      continue;\n    }\n    const v = obj[k];\n    copy[k] = isObject(v) ? recreateNonProtoObject(v) : v;\n  }\n  return /** @type {!JsonObject} */ (copy);\n}\n\n\n/**\n * Returns a value from an object for a field-based expression. The expression\n * is a simple nested dot-notation of fields, such as `field1.field2`. If any\n * field in a chain does not exist or is not an object, the returned value will\n * be `undefined`.\n *\n * @param {!JsonObject} obj\n * @param {string} expr\n * @return {*}\n */\nexport function getValueForExpr(obj, expr) {\n  // The `.` indicates \"the object itself\".\n  if (expr == '.') {\n    return obj;\n  }\n  // Otherwise, navigate via properties.\n  const parts = expr.split('.');\n  let value = obj;\n  for (let i = 0; i < parts.length; i++) {\n    const part = parts[i];\n    if (!part) {\n      value = undefined;\n      break;\n    }\n    if (!isObject(value) ||\n            value[part] === undefined ||\n            !hasOwnProperty(value, part)) {\n      value = undefined;\n      break;\n    }\n    value = value[part];\n  }\n  return value;\n}\n\n/**\n * Simple wrapper around JSON.parse that casts the return value\n * to JsonObject.\n * Create a new wrapper if an array return value is desired.\n * @param {*} json JSON string to parse\n * @return {?JsonObject|undefined} May be extend to parse arrays.\n */\nexport function parseJson(json) {\n  return /** @type {?JsonObject} */(JSON.parse(/** @type {string} */ (json)));\n}\n\n/**\n * Parses the given `json` string without throwing an exception if not valid.\n * Returns `undefined` if parsing fails.\n * Returns the `Object` corresponding to the JSON string when parsing succeeds.\n * @param {*} json JSON string to parse\n * @param {function(!Error)=} opt_onFailed Optional function that will be called\n *     with the error if parsing fails.\n * @return {?JsonObject|undefined} May be extend to parse arrays.\n */\nexport function tryParseJson(json, opt_onFailed) {\n  try {\n    return parseJson(json);\n  } catch (e) {\n    if (opt_onFailed) {\n      opt_onFailed(e);\n    }\n    return undefined;\n  }\n}\n\n\n/**\n * @param {*} obj\n * @param {string} key\n * @return {boolean}\n */\nfunction hasOwnProperty(obj, key) {\n  if (obj == null || typeof obj != 'object') {\n    return false;\n  }\n  return Object.prototype.hasOwnProperty.call(\n      /** @type {!Object} */ (obj), key);\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {getMode} from './mode';\nimport {getModeObject} from './mode-object';\nimport {isEnumValue} from './types';\n\n\n/** @const Time when this JS loaded.  */\nconst start = Date.now();\n\n/**\n * Triple zero width space.\n *\n * This is added to user error messages, so that we can later identify\n * them, when the only thing that we have is the message. This is the\n * case in many browsers when the global exception handler is invoked.\n *\n * @const {string}\n */\nexport const USER_ERROR_SENTINEL = '\\u200B\\u200B\\u200B';\n\n\n/**\n * @return {boolean} Whether this message was a user error.\n */\nexport function isUserErrorMessage(message) {\n  return message.indexOf(USER_ERROR_SENTINEL) >= 0;\n}\n\n\n/**\n * @enum {number}\n * @private Visible for testing only.\n */\nexport const LogLevel = {\n  OFF: 0,\n  ERROR: 1,\n  WARN: 2,\n  INFO: 3,\n  FINE: 4,\n};\n\n/**\n * Sets reportError function. Called from error.js to break cyclic\n * dependency.\n * @param {function(*, !Element=)|undefined} fn\n */\nexport function setReportError(fn) {\n  self.reportError = fn;\n}\n\n/**\n * Logging class.\n * @final\n * @private Visible for testing only.\n */\nexport class Log {\n  /**\n   * @param {!Window} win\n   * @param {function(!./mode.ModeDef):!LogLevel} levelFunc\n   * @param {string=} opt_suffix\n   */\n  constructor(win, levelFunc, opt_suffix) {\n    /**\n     * In tests we use the main test window instead of the iframe where\n     * the tests runs because only the former is relayed to the console.\n     * @const {!Window}\n     */\n    this.win = (getMode().test && win.AMP_TEST_IFRAME) ? win.parent : win;\n\n    /** @private @const {function(!./mode.ModeDef):!LogLevel} */\n    this.levelFunc_ = levelFunc;\n\n    /** @private @const {!LogLevel} */\n    this.level_ = this.calcLevel_();\n\n    /** @private @const {string} */\n    this.suffix_ = opt_suffix || '';\n  }\n\n  /**\n   * @return {!LogLevel}\n   * @private\n   */\n  calcLevel_() {\n    // No console - can't enable logging.\n    if (!this.win.console || !this.win.console.log) {\n      return LogLevel.OFF;\n    }\n\n    // Logging has been explicitly disabled.\n    if (getMode().log == '0') {\n      return LogLevel.OFF;\n    }\n\n    // Logging is enabled for tests directly.\n    if (getMode().test && this.win.ENABLE_LOG) {\n      return LogLevel.FINE;\n    }\n\n    // LocalDev by default allows INFO level, unless overriden by `#log`.\n    if (getMode().localDev && !getMode().log) {\n      return LogLevel.INFO;\n    }\n\n    // Delegate to the specific resolver.\n    return this.levelFunc_(getModeObject());\n  }\n\n  /**\n   * @param {string} tag\n   * @param {string} level\n   * @param {!Array} messages\n   */\n  msg_(tag, level, messages) {\n    if (this.level_ != LogLevel.OFF) {\n      let fn = this.win.console.log;\n      if (level == 'ERROR') {\n        fn = this.win.console.error || fn;\n      } else if (level == 'INFO') {\n        fn = this.win.console.info || fn;\n      } else if (level == 'WARN') {\n        fn = this.win.console.warn || fn;\n      }\n      messages.unshift(Date.now() - start, '[' + tag + ']');\n      fn.apply(this.win.console, messages);\n    }\n  }\n\n  /**\n   * Whether the logging is enabled.\n   * @return {boolean}\n   */\n  isEnabled() {\n    return this.level_ != LogLevel.OFF;\n  }\n\n  /**\n   * Reports a fine-grained message.\n   * @param {string} tag\n   * @param {...*} var_args\n   */\n  fine(tag, var_args) {\n    if (this.level_ >= LogLevel.FINE) {\n      this.msg_(tag, 'FINE', Array.prototype.slice.call(arguments, 1));\n    }\n  }\n\n  /**\n   * Reports a informational message.\n   * @param {string} tag\n   * @param {...*} var_args\n   */\n  info(tag, var_args) {\n    if (this.level_ >= LogLevel.INFO) {\n      this.msg_(tag, 'INFO', Array.prototype.slice.call(arguments, 1));\n    }\n  }\n\n  /**\n   * Reports a warning message.\n   * @param {string} tag\n   * @param {...*} var_args\n   */\n  warn(tag, var_args) {\n    if (this.level_ >= LogLevel.WARN) {\n      this.msg_(tag, 'WARN', Array.prototype.slice.call(arguments, 1));\n    }\n  }\n\n  /**\n   * Reports an error message. If the logging is disabled, the error is rethrown\n   * asynchronously.\n   * @param {string} tag\n   * @param {...*} var_args\n   * @return {!Error|undefined}\n   * @private\n   */\n  error_(tag, var_args) {\n    if (this.level_ >= LogLevel.ERROR) {\n      this.msg_(tag, 'ERROR', Array.prototype.slice.call(arguments, 1));\n    } else {\n      const error = createErrorVargs.apply(null,\n          Array.prototype.slice.call(arguments, 1));\n      this.prepareError_(error);\n      return error;\n    }\n  }\n\n  /**\n   * Reports an error message.\n   * @param {string} unusedTag\n   * @param {...*} var_args\n   * @return {!Error|undefined}\n   */\n  error(unusedTag, var_args) {\n    const error = this.error_.apply(this, arguments);\n    if (error) {\n      // reportError is installed globally per window in the entry point.\n      self.reportError(error);\n    }\n  }\n\n  /**\n   * Reports an error message and marks with an expected property. If the\n   * logging is disabled, the error is rethrown asynchronously.\n   * @param {string} unusedTag\n   * @param {...*} var_args\n   */\n  expectedError(unusedTag, var_args) {\n    const error = this.error_.apply(this, arguments);\n    if (error) {\n      error.expected = true;\n      // reportError is installed globally per window in the entry point.\n      self.reportError(error);\n    }\n  }\n\n  /**\n   * Creates an error object.\n   * @param {...*} var_args\n   * @return {!Error}\n   */\n  createError(var_args) {\n    const error = createErrorVargs.apply(null, arguments);\n    this.prepareError_(error);\n    return error;\n  }\n\n  /**\n   * Creates an error object with its expected property set to true.\n   * @param {...*} var_args\n   * @return {!Error}\n   */\n  createExpectedError(var_args) {\n    const error = createErrorVargs.apply(null, arguments);\n    this.prepareError_(error);\n    error.expected = true;\n    return error;\n  }\n\n  /**\n   * Throws an error if the first argument isn't trueish.\n   *\n   * Supports argument substitution into the message via %s placeholders.\n   *\n   * Throws an error object that has two extra properties:\n   * - associatedElement: This is the first element provided in the var args.\n   *   It can be used for improved display of error messages.\n   * - messageArray: The elements of the substituted message as non-stringified\n   *   elements in an array. When e.g. passed to console.error this yields\n   *   native displays of things like HTML elements.\n   *\n   * @param {T} shouldBeTrueish The value to assert. The assert fails if it does\n   *     not evaluate to true.\n   * @param {string=} opt_message The assertion message\n   * @param {...*} var_args Arguments substituted into %s in the message.\n   * @return {T} The value of shouldBeTrueish.\n   * @template T\n   */\n  /*eslint \"google-camelcase/google-camelcase\": 0*/\n  assert(shouldBeTrueish, opt_message, var_args) {\n    let firstElement;\n    if (!shouldBeTrueish) {\n      const message = opt_message || 'Assertion failed';\n      const splitMessage = message.split('%s');\n      const first = splitMessage.shift();\n      let formatted = first;\n      const messageArray = [];\n      pushIfNonEmpty(messageArray, first);\n      for (let i = 2; i < arguments.length; i++) {\n        const val = arguments[i];\n        if (val && val.tagName) {\n          firstElement = val;\n        }\n        const nextConstant = splitMessage.shift();\n        messageArray.push(val);\n        pushIfNonEmpty(messageArray, nextConstant.trim());\n        formatted += toString(val) + nextConstant;\n      }\n      const e = new Error(formatted);\n      e.fromAssert = true;\n      e.associatedElement = firstElement;\n      e.messageArray = messageArray;\n      this.prepareError_(e);\n      // reportError is installed globally per window in the entry point.\n      self.reportError(e);\n      throw e;\n    }\n    return shouldBeTrueish;\n  }\n\n  /**\n   * Throws an error if the first argument isn't an Element\n   *\n   * Otherwise see `assert` for usage\n   *\n   * @param {*} shouldBeElement\n   * @param {string=} opt_message The assertion message\n   * @return {!Element} The value of shouldBeTrueish.\n   * @template T\n   */\n  /*eslint \"google-camelcase/google-camelcase\": 2*/\n  assertElement(shouldBeElement, opt_message) {\n    const shouldBeTrueish = shouldBeElement && shouldBeElement.nodeType == 1;\n    this.assert(shouldBeTrueish, (opt_message || 'Element expected') + ': %s',\n        shouldBeElement);\n    return /** @type {!Element} */ (shouldBeElement);\n  }\n\n  /**\n   * Throws an error if the first argument isn't a string. The string can\n   * be empty.\n   *\n   * For more details see `assert`.\n   *\n   * @param {*} shouldBeString\n   * @param {string=} opt_message The assertion message\n   * @return {string} The string value. Can be an empty string.\n   */\n  /*eslint \"google-camelcase/google-camelcase\": 2*/\n  assertString(shouldBeString, opt_message) {\n    this.assert(typeof shouldBeString == 'string',\n        (opt_message || 'String expected') + ': %s', shouldBeString);\n    return /** @type {string} */ (shouldBeString);\n  }\n\n  /**\n   * Throws an error if the first argument isn't a number. The allowed values\n   * include `0` and `NaN`.\n   *\n   * For more details see `assert`.\n   *\n   * @param {*} shouldBeNumber\n   * @param {string=} opt_message The assertion message\n   * @return {number} The number value. The allowed values include `0`\n   *   and `NaN`.\n   */\n  assertNumber(shouldBeNumber, opt_message) {\n    this.assert(typeof shouldBeNumber == 'number',\n        (opt_message || 'Number expected') + ': %s', shouldBeNumber);\n    return /** @type {number} */ (shouldBeNumber);\n  }\n\n  /**\n   * Asserts and returns the enum value. If the enum doesn't contain such a value,\n   * the error is thrown.\n   *\n   * @param {!Object<T>} enumObj\n   * @param {string} s\n   * @param {string=} opt_enumName\n   * @return T\n   * @template T\n   */\n  /*eslint \"google-camelcase/google-camelcase\": 2*/\n  assertEnumValue(enumObj, s, opt_enumName) {\n    if (isEnumValue(enumObj, s)) {\n      return s;\n    }\n    this.assert(false,\n        'Unknown %s value: \"%s\"',\n        opt_enumName || 'enum', s);\n  }\n\n  /**\n   * @param {!Error} error\n   * @private\n   */\n  prepareError_(error) {\n    error = duplicateErrorIfNecessary(error);\n    if (this.suffix_) {\n      if (!error.message) {\n        error.message = this.suffix_;\n      } else if (error.message.indexOf(this.suffix_) == -1) {\n        error.message += this.suffix_;\n      }\n    } else if (isUserErrorMessage(error.message)) {\n      error.message = error.message.replace(USER_ERROR_SENTINEL, '');\n    }\n  }\n}\n\n\n/**\n * @param {string|!Element} val\n * @return {string}\n */\nfunction toString(val) {\n  // Do check equivalent to `val instanceof Element` without cross-window bug\n  if (val && val.nodeType == 1) {\n    return val.tagName.toLowerCase() + (val.id ? '#' + val.id : '');\n  }\n  return /** @type {string} */ (val);\n}\n\n\n/**\n * @param {!Array} array\n * @param {*} val\n */\nfunction pushIfNonEmpty(array, val) {\n  if (val != '') {\n    array.push(val);\n  }\n}\n\n/**\n * Some exceptions (DOMException, namely) have read-only message.\n * @param {!Error} error\n * @return {!Error};\n */\nexport function duplicateErrorIfNecessary(error) {\n  const message = error.message;\n  const test = String(Math.random());\n  error.message = test;\n\n  if (error.message === test) {\n    error.message = message;\n    return error;\n  }\n\n  const e = new Error(error.message);\n  // Copy all the extraneous things we attach.\n  for (const prop in error) {\n    e[prop] = error[prop];\n  }\n  // Ensure these are copied.\n  e.stack = error.stack;\n  return e;\n}\n\n/**\n * @param {...*} var_args\n * @return {!Error}\n * @private\n */\nfunction createErrorVargs(var_args) {\n  let error = null;\n  let message = '';\n  for (let i = 0; i < arguments.length; i++) {\n    const arg = arguments[i];\n    if (arg instanceof Error && !error) {\n      error = duplicateErrorIfNecessary(arg);\n    } else {\n      if (message) {\n        message += ' ';\n      }\n      message += arg;\n    }\n  }\n\n  if (!error) {\n    error = new Error(message);\n  } else if (message) {\n    error.message = message + ': ' + error.message;\n  }\n  return error;\n}\n\n\n/**\n * Rethrows the error without terminating the current context. This preserves\n * whether the original error designation is a user error or a dev error.\n * @param {...*} var_args\n */\nexport function rethrowAsync(var_args) {\n  const error = createErrorVargs.apply(null, arguments);\n  setTimeout(() => {\n    // reportError is installed globally per window in the entry point.\n    self.reportError(error);\n    throw error;\n  });\n}\n\n\n/**\n * Cache for logs. We do not use a Service since the service module depends\n * on Log and closure literally can't even.\n * @type {{user: ?Log, dev: ?Log}}\n */\nself.log = (self.log || {\n  user: null,\n  dev: null,\n});\n\nconst logs = self.log;\n\n/**\n * Eventually holds a constructor for Log objects. Lazily initialized, so we\n * can avoid ever referencing the real constructor except in JS binaries\n * that actually want to include the implementation.\n * @type {?Function}\n */\nlet logConstructor = null;\n\n\nexport function initLogConstructor() {\n  logConstructor = Log;\n  // Initialize instances for use. If a binary (an extension for example) that\n  // does not call `initLogConstructor` invokes `dev()` or `user()` earlier\n  // than the binary that does call `initLogConstructor` (amp.js), the extension\n  // will throw an error as that extension will never be able to initialize\n  // the log instances and we also don't want it to call `initLogConstructor`\n  // either (since that will cause the Log implementation to be bundled into that\n  // binary). So we must initialize the instances eagerly so that they are\n  // ready for use (stored globally) after the main binary calls\n  // `initLogConstructor`.\n  dev();\n  user();\n}\n\nexport function resetLogConstructorForTesting() {\n  logConstructor = null;\n}\n\n\n/**\n * Publisher level log.\n *\n * Enabled in the following conditions:\n *  1. Not disabled using `#log=0`.\n *  2. Development mode is enabled via `#development=1` or logging is explicitly\n *     enabled via `#log=D` where D >= 1.\n *\n * @return {!Log}\n */\nexport function user() {\n  if (logs.user) {\n    return logs.user;\n  }\n  if (!logConstructor) {\n    throw new Error('failed to call initLogConstructor');\n  }\n  return logs.user = new logConstructor(self, mode => {\n    const logNum = parseInt(mode.log, 10);\n    if (mode.development || logNum >= 1) {\n      return LogLevel.FINE;\n    }\n    return LogLevel.OFF;\n  }, USER_ERROR_SENTINEL);\n}\n\n\n/**\n * AMP development log. Calls to `devLog().assert` and `dev.fine` are stripped in\n * the PROD binary. However, `devLog().assert` result is preserved in either case.\n *\n * Enabled in the following conditions:\n *  1. Not disabled using `#log=0`.\n *  2. Logging is explicitly enabled via `#log=D`, where D >= 2.\n *\n * @return {!Log}\n */\nexport function dev() {\n  if (logs.dev) {\n    return logs.dev;\n  }\n  if (!logConstructor) {\n    throw new Error('failed to call initLogConstructor');\n  }\n  return logs.dev = new logConstructor(self, mode => {\n    const logNum = parseInt(mode.log, 10);\n    if (logNum >= 3) {\n      return LogLevel.FINE;\n    }\n    if (logNum >= 2) {\n      return LogLevel.INFO;\n    }\n    return LogLevel.OFF;\n  });\n}\n","/**\n * Copyright 2016 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {getMode} from './mode';\n\n/**\n * Provides info about the current app. This return value may be cached and\n * passed around as it will always be DCE'd.\n * @param {?Window=} opt_win\n * @return {!./mode.ModeDef}\n */\nexport function getModeObject(opt_win) {\n  return {\n    localDev: getMode(opt_win).localDev,\n    development: getMode(opt_win).development,\n    filter: getMode(opt_win).filter,\n    minified: getMode(opt_win).minified,\n    lite: getMode(opt_win).lite,\n    test: getMode(opt_win).test,\n    log: getMode(opt_win).log,\n    version: getMode(opt_win).version,\n    rtvVersion: getMode(opt_win).rtvVersion,\n  };\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {startsWith} from './string';\nimport {parseQueryString_} from './url-parse-query-string';\n\n/**\n * @typedef {{\n *   localDev: boolean,\n *   development: boolean,\n *   filter: (string|undefined),\n *   minified: boolean,\n *   lite: boolean,\n *   test: boolean,\n *   log: (string|undefined),\n *   version: string,\n *   rtvVersion: string,\n * }}\n */\nexport let ModeDef;\n\n/** @type {string} */\nconst version = '$internalRuntimeVersion$';\n\n/**\n * `rtvVersion` is the prefixed version we serve off of the cdn.\n * The prefix denotes canary(00) or prod(01) or an experiment version ( > 01).\n * @type {string}\n */\nlet rtvVersion = '';\n\n/**\n * A #querySelector query to see if we have any scripts with development paths.\n * @type {string}\n */\nconst developmentScriptQuery = 'script[src*=\"/dist/\"],script[src*=\"/base/\"]';\n\n/**\n * Provides info about the current app.\n * @param {?Window=} opt_win\n * @return {!ModeDef}\n */\nexport function getMode(opt_win) {\n  const win = opt_win || self;\n  if (win.AMP_MODE) {\n    return win.AMP_MODE;\n  }\n  return win.AMP_MODE = getMode_(win);\n}\n\n/**\n * Provides info about the current app.\n * @param {!Window} win\n * @return {!ModeDef}\n */\nfunction getMode_(win) {\n  // For 3p integration code\n  if (win.context && win.context.mode) {\n    return win.context.mode;\n  }\n\n  // Magic constants that are replaced by closure compiler.\n  // IS_MINIFIED is always replaced with true when closure compiler is used\n  // while IS_DEV is only replaced when the --fortesting flag is NOT used.\n  const IS_DEV = true;\n  const IS_MINIFIED = false;\n  const FORCE_LOCALDEV = !!(self.AMP_CONFIG && self.AMP_CONFIG.localDev);\n  const AMP_CONFIG_3P_FRAME_HOST = self.AMP_CONFIG &&\n      self.AMP_CONFIG.thirdPartyFrameHost;\n\n  const isLocalDev = IS_DEV && !!(win.location.hostname == 'localhost' ||\n      (FORCE_LOCALDEV && win.location.hostname == AMP_CONFIG_3P_FRAME_HOST) ||\n      (win.location.ancestorOrigins && win.location.ancestorOrigins[0] &&\n        startsWith(win.location.ancestorOrigins[0], 'http://localhost:'))) &&\n      // Filter out localhost running against a prod script.\n      // Because all allowed scripts are ours, we know that these can only\n      // occur during local dev.\n      (!win.document || !!win.document.querySelector(developmentScriptQuery));\n\n  const hashQuery = parseQueryString_(\n      // location.originalHash is set by the viewer when it removes the fragment\n      // from the URL.\n      win.location.originalHash || win.location.hash);\n\n  const searchQuery = parseQueryString_(win.location.search);\n\n  if (!rtvVersion) {\n    rtvVersion = getRtvVersion(win, isLocalDev);\n  }\n\n  // The `minified`, `test` and `localDev` properties are replaced\n  // as boolean literals when we run `gulp dist` without the `--fortesting`\n  // flags. This improved DCE on the production file we deploy as the code\n  // paths for localhost/testing/development are eliminated.\n  return {\n    localDev: isLocalDev,\n    // Triggers validation\n    development: !!(hashQuery['development'] == '1' ||\n        win.AMP_DEV_MODE),\n    examiner: hashQuery['development'] == '2',\n    // Allows filtering validation errors by error category. For the\n    // available categories, see ErrorCategory in validator/validator.proto.\n    filter: hashQuery['filter'],\n    minified: IS_MINIFIED,\n    // Whether document is in an amp-lite viewer. It signal that the user\n    // would prefer to use less bandwidth.\n    lite: searchQuery['amp_lite'] != undefined,\n    test: IS_DEV && !!(win.AMP_TEST || win.__karma__),\n    log: hashQuery['log'],\n    version,\n    rtvVersion,\n  };\n}\n\n/**\n * Retrieve the `rtvVersion` which will have a numeric prefix\n * denoting canary/prod/experiment (unless `isLocalDev` is true).\n *\n * @param {!Window} win\n * @param {boolean} isLocalDev\n * @return {string}\n */\nfunction getRtvVersion(win, isLocalDev) {\n  // If it's local dev then we won't actually have a full version so\n  // just use the version.\n  if (isLocalDev) {\n    return version;\n  }\n\n  if (win.AMP_CONFIG && win.AMP_CONFIG.v) {\n    return win.AMP_CONFIG.v;\n  }\n\n  // Currently `$internalRuntimeVersion$` and thus `mode.version` contain only\n  // major version. The full version however must also carry the minor version.\n  // We will default to production default `01` minor version for now.\n  // TODO(erwinmombay): decide whether $internalRuntimeVersion$ should contain\n  // minor version.\n  return `01${version}`;\n}\n\n\n/**\n * @param {!Window} win\n * @param {boolean} isLocalDev\n * @return {string}\n * @visibleForTesting\n */\nexport function getRtvVersionForTesting(win, isLocalDev) {\n  return getRtvVersion(win, isLocalDev);\n}\n\n\n/** @visibleForTesting */\nexport function resetRtvVersionForTesting() {\n  rtvVersion = '';\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @param {string} _match\n * @param {string} character\n * @return {string}\n */\nfunction toUpperCase(_match, character) {\n  return character.toUpperCase();\n}\n\n/**\n * @param {string} name Attribute name with dashes\n * @return {string} Dashes removed and character after to upper case.\n * visibleForTesting\n */\nexport function dashToCamelCase(name) {\n  return name.replace(/-([a-z])/g, toUpperCase);\n}\n\n/**\n * @param {string} name Attribute name with dashes\n * @return {string} Dashes replaced by underlines.\n */\nexport function dashToUnderline(name) {\n  return name.replace('-', '_');\n}\n\n/**\n * Polyfill for String.prototype.endsWith.\n * @param {string} string\n * @param {string} suffix\n * @return {boolean}\n */\nexport function endsWith(string, suffix) {\n  const index = string.length - suffix.length;\n  return index >= 0 && string.indexOf(suffix, index) == index;\n}\n\n/**\n * Polyfill for String.prototype.startsWith.\n * @param {string} string\n * @param {string} prefix\n * @return {boolean}\n */\nexport function startsWith(string, prefix) {\n  if (prefix.length > string.length) {\n    return false;\n  }\n  return string.lastIndexOf(prefix, 0) == 0;\n}\n\n/**\n * Expands placeholders in a given template string with values.\n *\n * Placeholders use ${key-name} syntax and are replaced with the value\n * returned from the given getter function.\n *\n * @param {string} template The template string to expand.\n * @param {!function(string):*} getter Function used to retrieve a value for a\n *   placeholder. Returns values will be coerced into strings.\n * @param {number=} opt_maxIterations Number of times to expand the template.\n *   Defaults to 1, but should be set to a larger value your placeholder tokens\n *   can be expanded to other placeholder tokens. Take caution with large values\n *   as recursively expanding a string can be exponentially expensive.\n */\nexport function expandTemplate(template, getter, opt_maxIterations) {\n  const maxIterations = opt_maxIterations || 1;\n  for (let i = 0; i < maxIterations; i++) {\n    let matches = 0;\n    template = template.replace(/\\${([^}]*)}/g, (_a, b) => {\n      matches++;\n      return getter(b);\n    });\n    if (!matches) {\n      break;\n    }\n  }\n  return template;\n}\n","/**\n * Copyright 2015 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* @const */\nconst toString_ = Object.prototype.toString;\n\n/**\n * Returns the ECMA [[Class]] of a value\n * @param {*} value\n * @return {string}\n */\nfunction toString(value) {\n  return toString_.call(value);\n}\n\n/**\n * Determines if value is actually an Array.\n * @param {*} value\n * @return {boolean}\n */\nexport function isArray(value) {\n  return Array.isArray(value);\n}\n\n/**\n * Converts an array-like object to an array.\n * @param {?IArrayLike<T>|string} arrayLike\n * @return {!Array<T>}\n * @template T\n */\nexport function toArray(arrayLike) {\n  if (!arrayLike) {\n    return [];\n  }\n  const array = new Array(arrayLike.length);\n  for (let i = 0; i < arrayLike.length; i++) {\n    array[i] = arrayLike[i];\n  }\n  return array;\n}\n\n/**\n * Determines if value is actually an Object.\n * @param {*} value\n * @return {boolean}\n */\nexport function isObject(value) {\n  return toString(value) === '[object Object]';\n}\n\n/**\n * Determines if value is of number type and finite.\n * NaN and Infinity are not considered a finite number.\n * String numbers are not considered numbers.\n * @param {*} value\n * @return {boolean}\n */\nexport function isFiniteNumber(value) {\n  return (typeof value === 'number' && isFinite(value));\n}\n\n/**\n * Determines if value is of FormData type.\n * @param {*} value\n * @return {boolean}\n */\nexport function isFormData(value) {\n  return toString(value) === '[object FormData]';\n}\n\n/**\n * Checks whether `s` is a valid value of `enumObj`.\n *\n * @param {!Object<T>} enumObj\n * @param {T} s\n * @return {boolean}\n * @template T\n */\nexport function isEnumValue(enumObj, s) {\n  for (const k in enumObj) {\n    if (enumObj[k] === s) {\n      return true;\n    }\n  }\n  return false;\n}\n","/**\n * Copyright 2017 The AMP HTML Authors. All Rights Reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS-IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst regex = /(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;\n\n/**\n * Parses the query string of an URL. This method returns a simple key/value\n * map. If there are duplicate keys the latest value is returned.\n *\n * DO NOT import the function from this file. Instead, import parseQueryString\n * from `src/url.js`.\n *\n * @param {string} queryString\n * @return {!JsonObject}\n */\nexport function parseQueryString_(queryString) {\n  const params = /** @type {!JsonObject} */ (Object.create(null));\n  if (!queryString) {\n    return params;\n  }\n\n  let match;\n  while ((match = regex.exec(queryString))) {\n    const name = decodeURIComponent(match[1]).trim();\n    const value = match[2] ? decodeURIComponent(match[2]).trim() : '';\n    params[name] = value;\n  }\n  return params;\n}\n","(function (global) {\n  var babelHelpers = global.babelHelpers = {};\n\n  babelHelpers.inherits = function (subClass, superClass) {\n    if (typeof superClass !== \"function\" && superClass !== null) {\n      throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n    }\n\n    subClass.prototype = Object.create(superClass && superClass.prototype, {\n      constructor: {\n        value: subClass,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n  };\n\n  babelHelpers.createClass = (function () {\n    function defineProperties(target, props) {\n      for (var i = 0; i < props.length; i++) {\n        var descriptor = props[i];\n        descriptor.enumerable = descriptor.enumerable || false;\n        descriptor.configurable = true;\n        if (\"value\" in descriptor) descriptor.writable = true;\n        Object.defineProperty(target, descriptor.key, descriptor);\n      }\n    }\n\n    return function (Constructor, protoProps, staticProps) {\n      if (protoProps) defineProperties(Constructor.prototype, protoProps);\n      if (staticProps) defineProperties(Constructor, staticProps);\n      return Constructor;\n    };\n  })();\n\n  babelHelpers.slice = Array.prototype.slice;\n  babelHelpers.bind = Function.prototype.bind;\n\n  babelHelpers.interopRequireWildcard = function (obj) {\n    if (obj && obj.__esModule) {\n      return obj;\n    } else {\n      var newObj = {};\n\n      if (obj != null) {\n        for (var key in obj) {\n          if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];\n        }\n      }\n\n      newObj[\"default\"] = obj;\n      return newObj;\n    }\n  };\n\n  babelHelpers.interopRequireDefault = function (obj) {\n    return obj && obj.__esModule ? obj : { default: obj };\n  };\n\n  babelHelpers.get = function get(object, property, receiver) {\n    if (object === null) object = Function.prototype;\n    var desc = Object.getOwnPropertyDescriptor(object, property);\n\n    if (desc === undefined) {\n      var parent = Object.getPrototypeOf(object);\n\n      if (parent === null) {\n        return undefined;\n      } else {\n        return get(parent, property, receiver);\n      }\n    } else if (\"value\" in desc) {\n      return desc.value;\n    } else {\n      var getter = desc.get;\n\n      if (getter === undefined) {\n        return undefined;\n      }\n\n      return getter.call(receiver);\n    }\n  };\n\n  babelHelpers.classCallCheck = function (instance, Constructor) {\n    if (!(instance instanceof Constructor)) {\n      throw new TypeError(\"Cannot call a class as a function\");\n    }\n  };\n\n  babelHelpers.defineProperty = function(obj, key, value) {\n      obj[key] = value;\n      return obj;\n  };\n})(typeof global === \"undefined\" ? self : global);\n"]}