(self.AMP=self.AMP||[]).push({n:"amp-dailymotion",v:"123456789",f:(function(AMP){var g;(function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global?global:a})(this);function m(a,c){function b(){}b.prototype=c.prototype;a.prototype=new b;a.prototype.constructor=a;for(var d in c)if(Object.defineProperties){var f=Object.getOwnPropertyDescriptor(c,d);f&&Object.defineProperty(a,d,f)}else a[d]=c[d]};var p=/(?:^[#?]?|&)([^=&]+)(?:=([^&]*))?/g;function q(a){var c=Object.create(null);if(!a)return c;for(var b;b=p.exec(a);){var d=decodeURIComponent(b[1]).trim(),f=b[2]?decodeURIComponent(b[2]).trim():"";c[d]=f}return c};var r="";
function t(a){var c=a||self,b;if(c.AMP_MODE)b=c.AMP_MODE;else{b=c;if(b.context&&b.context.mode)b=b.context.mode;else{var d=q(b.location.originalHash||b.location.hash),f=q(b.location.search);r||(r=b.AMP_CONFIG&&b.AMP_CONFIG.v?b.AMP_CONFIG.v:"01123456789");b={localDev:!1,development:!("1"!=d.development&&!b.AMP_DEV_MODE),examiner:"2"==d.development,filter:d.filter,minified:!0,lite:void 0!=f.amp_lite,test:!1,log:d.log,version:"123456789",rtvVersion:r}}b=c.AMP_MODE=b}return b}
;Date.now();self.log=self.log||{user:null,dev:null};var u=self.log;function v(a){var c=Object.create(null);a&&Object.assign(c,a);return c};function w(a,c){a=a.__AMP_TOP||a;return x(a,c)}function y(a){var c=z,b=A(a),d=B(b);a=d;var f=C(a),e=f["video-manager"];e||(e=f["video-manager"]={obj:null,promise:null,resolve:null,context:null,ctor:null});e.ctor||e.obj||(e.ctor=c,e.context=b,e.resolve&&x(a,"video-manager"))}function D(a,c){a=A(a);a=B(a);return x(a,c)}function A(a){return a.nodeType?w((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function B(a){a=A(a);return a.isSingleDoc()?a.win:a}
function x(a,c){var b=C(a);a=b[c];a.obj||(a.obj=new a.ctor(a.context),a.ctor=null,a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function C(a){var c=a.services;c||(c=a.services={});return c};var E,F="Webkit webkit Moz moz ms O o".split(" ");function G(a){var c={position:"fixed",top:"0",width:"0",height:"0",opacity:"0"},b;for(b in c){var d=a,f=c[b],e;e=d.style;var h=b;if(2>h.length?0:0==h.lastIndexOf("--",0))e=h;else{E||(E=v());var k=E[h];if(!k){k=h;if(void 0===e[h]){var l;l=h;l=l.charAt(0).toUpperCase()+l.slice(1);b:{for(var n=0;n<F.length;n++){var H=F[n]+l;if(void 0!==e[H]){l=H;break b}}l=""}void 0!==e[l]&&(k=l)}E[h]=k}e=k}e&&(d.style[e]=f)}};function I(a,c,b){function d(a){try{return h(a)}catch(n){throw self.reportError(n),n;}}var f=void 0,e=a,h=b,k=f||!1;e.addEventListener(c,d,k);return function(){e&&e.removeEventListener(c,d,k);d=e=h=null}};function J(a,c,b){return I(a,c,b)}function K(a,c){var b=c,d=I(a,"load",function(a){try{b(a)}finally{b=null,d()}});return d}function L(a){var c,b,d=new Promise(function(c){b=K(a,c)});d.then(b,b);c&&c(b);return d};function z(a){this.b=a;this.a=null;this.B=!1}z.prototype.register=function(a){var c=a;c.registerAction("play",c.play.bind(c,!1),3);c.registerAction("pause",c.pause.bind(c),1);c.registerAction("mute",c.mute.bind(c),1);c.registerAction("unmute",c.unmute.bind(c),3);if(a.supportsPlatform()){this.a=this.a||[];var b=new M(this.b,a);N(this,b);this.a.push(b)}};
function N(a,c){if(c.video.element.hasAttribute("autoplay")&&(J(c.video.element,"amp:video:visibility",function(){c.updateVisibility()}),J(c.video.element,"reloaded",function(){c.updateVisibility();c.o=!0;c.c&&c.f&&O(c)}),!a.B)){var b=function(){for(var b=0;b<a.a.length;b++)a.a[b].updateVisibility()},d=D(a.b,"viewport");d.onScroll(b);d.onChanged(b);a.B=!0}}function P(a,c){for(var b=0;b<a.a.length;b++)if(a.a[b].video===c)return a.a[b];return null}
z.prototype.getPlayingState=function(a){return P(this,a).getPlayingState()};z.prototype.userInteractedWithAutoPlay=function(a){return P(this,a).userInteractedWithAutoPlay()};
function M(a,c){var b=this;this.b=a;this.video=c;this.K=null;this.c=this.i=this.o=!1;this.s=w(a.win,"vsync");this.u=Q.bind(null,a.win,t(a.win).lite);a=c.element;this.f=a.hasAttribute("autoplay");this.w=this.m=!1;L(a).then(function(){b.updateVisibility();b.o=!0;b.c&&b.f&&O(b)});J(this.video.element,"pause",this.I.bind(this));J(this.video.element,"play",this.J.bind(this));this.updateVisibility();this.f&&R(this)}g=M.prototype;g.J=function(){this.i=!0};g.I=function(){this.i=!1};
function R(a){a.video.isInteractive()&&a.video.hideControls();a.u().then(function(c){!c&&a.video.isInteractive()?a.video.showControls():(a.video.mute(),a.video.isInteractive()&&S(a))})}
function S(a){function c(b){a.s.mutate(function(){d.classList.toggle("amp-video-eq-play",b)})}function b(){this.m=!0;this.video.showControls();this.video.unmute();e();h();k();d.remove();f.remove()}a.video.hideControls();var d=T(a),f=U(a);a.s.mutate(function(){a.video.element.appendChild(d);a.video.element.appendChild(f)});var e=J(f,"click",b.bind(a)),h=J(a.video.element,"pause",c.bind(a,!1)),k=J(a.video.element,"play",c.bind(a,!0))}
function O(a){!a.m&&D(a.b,"viewer").isVisible()&&a.u().then(function(c){c&&(a.c?(a.video.play(!0),a.w=!0):a.video.pause())})}
function T(a){var c=a.b.win.document,b=c.createElement("i-amphtml-video-eq");b.classList.add("amp-video-eq");for(var d=1;4>=d;d++){var f=c.createElement("div");f.classList.add("amp-video-eq-col");for(var e=1;2>=e;e++){var h=c.createElement("div");h.classList.add("amp-video-eq-"+d+"-"+e);f.appendChild(h)}b.appendChild(f)}var k=w(a.b.win,"platform");k.isIos()&&b.setAttribute("unpausable","");return b}
function U(a){a=a.b.win.document.createElement("i-amphtml-video-mask");a.classList.add("i-amphtml-fill-content");return a}g.updateVisibility=function(){function a(){b.c!=d&&b.o&&b.f&&O(b)}function c(){if(b.video.isInViewport()){var a=b.video.element.getIntersectionChangeEntry(),c=a.intersectionRatio,d="number"===typeof c&&isFinite(c)?100*a.intersectionRatio:0;b.c=75<=d}else b.c=!1}var b=this,d=this.c;this.s.run({measure:c,mutate:a})};
g.getPlayingState=function(){return this.i?this.i&&this.w&&!this.m?"playing_auto":"playing_manual":"paused"};g.userInteractedWithAutoPlay=function(){return this.m};var V=null;
function Q(a,c){if(V)return V;if(c)return V=Promise.resolve(!1);var b=a.document.createElement("video");b.setAttribute("muted","");b.setAttribute("playsinline","");b.setAttribute("webkit-playsinline","");b.muted=!0;b.playsinline=!0;b.webkitPlaysinline=!0;b.setAttribute("height","0");b.setAttribute("width","0");G(b);try{var d=b.play();d&&d.catch&&d.catch(function(){})}catch(f){}return V=Promise.resolve(!b.paused)};function W(a){AMP.BaseElement.call(this,a);this.l="unstarted";this.g=this.F=null;this.f=this.h=!1;this.D=this.C=this.A=this.j=this.H=null}m(W,AMP.BaseElement);g=W.prototype;g.preconnectCallback=function(a){this.preconnect.url("https://www.dailymotion.com",a);this.preconnect.url("https://static1.dmcdn.net",a)};g.supportsPlatform=function(){return!0};g.isInteractive=function(){return!0};g.isLayoutSupported=function(a){return"fixed"==a||"fixed-height"==a||"responsive"==a||"fill"==a||"flex-item"==a};
g.viewportCallback=function(a){this.element.dispatchCustomEvent("amp:video:visibility",{visible:a})};g.buildCallback=function(){var a=this,c;if(u.user)c=u.user;else throw Error("failed to call initLogConstructor");this.F=c.assert(this.element.getAttribute("data-videoid"),"The data-videoid attribute is required for <amp-dailymotion> %s",this.element);y(this.element);D(this.element,"video-manager").register(this);this.j=new Promise(function(b){a.A=b});this.C=new Promise(function(b){a.D=b})};
g.layoutCallback=function(){var a=this.element.ownerDocument.createElement("iframe");a.setAttribute("frameborder","0");a.setAttribute("allowfullscreen","true");a.src="https://www.dailymotion.com/embed/video/"+encodeURIComponent(this.F||"")+"?"+X(this);this.applyFillContent(a);this.element.appendChild(a);this.g=a;this.H=J(this.win,"message",this.G.bind(this));this.f=this.element.hasAttribute("autoplay");return this.loadPromise(this.g)};
g.G=function(a){if("https://www.dailymotion.com"==a.origin&&a.source==this.g.contentWindow&&a.data&&a.type&&"message"==a.type&&(a=q(a.data),void 0!==a))switch(a.event){case "apiready":this.A(!0);this.element.dispatchCustomEvent("load");break;case "end":case "pause":this.element.dispatchCustomEvent("pause");this.l="pause";break;case "play":this.element.dispatchCustomEvent("play");this.l="play";break;case "volumechange":if("unstarted"==this.l||this.h!=(0==a.volume||"true"==a.muted))(this.h=0==a.volume||
"true"==a.muted)?this.element.dispatchCustomEvent("muted"):this.element.dispatchCustomEvent("unmuted");break;case "progress":this.D(!0)}};function Y(a,c,b){var d="https://www.dailymotion.com";a.j.then(function(){if(a.g&&a.g.contentWindow){var f=JSON.stringify(v({command:c,parameters:b||[]}));a.g.contentWindow.postMessage(f,d)}})}
function X(a){var c=["api=1","html=1","app=amp"],b="mute endscreen-enable sharing-enable start ui-highlight ui-logo info".split(" ");b.forEach(function(b){var d=b,e=a.element.getAttribute("data-"+d);e&&c.push(encodeURIComponent(d)+"="+encodeURIComponent(e))});return c.join("&")}g.pauseCallback=function(){this.pause()};g.play=function(a){var c=this;Y(this,"play");a&&"pause"!=this.l&&this.C.then(function(){Y(c,"play")})};g.pause=function(){Y(this,"pause")};
g.mute=function(){var a=this;Y(this,"muted",[!0]);this.j.then(function(){a.element.dispatchCustomEvent("muted");a.h=!0})};g.unmute=function(){var a=this;Y(this,"muted",[!1]);this.j.then(function(){a.element.dispatchCustomEvent("unmuted");a.h=!1})};g.showControls=function(){};g.hideControls=function(){};AMP.registerElement("amp-dailymotion",W);
})});
//# sourceMappingURL=amp-dailymotion-0.1.js.map

